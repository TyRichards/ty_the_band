(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){var Player,l10n=huesos.l10n,mejsCreateErrorMessage=mejs.HtmlMediaElementShim.createErrorMessage,settings=huesos.player.settings,Tracks=require("./tracks");Player=Backbone.Model.extend({defaults:{currentTime:0,currentTrackIndex:0,duration:0,loop:true,repeat:false,shuffle:false,status:"",volume:.8},initialize:function(attributes,options){var self=this;this.options=_.extend({id:"huesos-player",persist:false,tracks:null},options);this.currentTimeIntervalId=null;this.currentTrack=null;this.initialCurrentTime=0;this.media=null;this.mediaCanPlay=false;this.playIntervalId=null;this.tracks=this.options.tracks||new Tracks;delete this.options.tracks;if(this.options.persist){this.fetchTracks();this.on("change",this.save,this);this.tracks.on("add remove reset",this.tracks.save,this.tracks)}_.bindAll(this,"bindAudio","onMediaCanPlay","onMediaEnded","onMediaError","onMediaLoadedMetadata","onMediaPause","onMediaPlaying","onMediaTimeUpdate","onMediaVolumeChange","onUserGesture");if(mejs.MediaFeatures.isAndroid||mejs.MediaFeatures.isiOS){Backbone.$(window).on("keydown.huesosPlayer mousedown.huesosPlayer pointerdown.huesosPlayer touchstart.huesosPlayer",this.onUserGesture)}mejs.HtmlMediaElementShim.createErrorMessage=function(playback,options,poster){if("huesos"in options){self.set("status","error");self.currentTrack&&self.currentTrack.set("status","error");return}mejsCreateErrorMessage.apply(this,arguments)}},onUserGesture:function(){Backbone.$(window).off("keydown.huesosPlayer mousedown.huesosPlayer pointerdown.huesosPlayer touchstart.huesosPlayer",this.onUserGesture);if(!this.media||!!"load"in this.media){return}this.media.load();this.setCurrentTime(this.initialCurrentTime)},getProgress:function(){var currentTime=this.get("currentTime"),duration=this.get("duration");return currentTime/duration},loadTrack:function(track){if("undefined"===typeof this.mediaNode){this.mediaNode=document.createElement("audio")}if(this.currentTrack){this.currentTrack.set("status","error"===this.currentTrack.get("status")?"error":"paused")}if(null!==this.media&&track.get("type")!==this.currentTrack.get("type")){if(this.media&&!!"pause"in this.media){this.media.pause();this.media.remove()}this.media=null}this.set("status","loading");this.currentTrack=track;this.currentTrack.set("status","loading");if(null===this.media){this.mediaCanPlay=false;this.mediaNode.setAttribute("preload","auto");this.mediaNode.setAttribute("src",track.get("src"));this.mediaNode.setAttribute("type",track.get("type"));try{this.media=new MediaElement(this.mediaNode,{huesos:true,pluginPath:settings.mejs.pluginPath||mejs.Utility.getScriptPath(["mediaelement.js","mediaelement.min.js","mediaelement-and-player.js","mediaelement-and-player.min.js"]),startVolume:this.get("volume"),success:this.bindAudio})}catch(ex){this.media=null}}else{this.media.pause();this.media.setSrc(track.get("src"));this.media.load()}this.trigger("change:track",track)},nextTrack:function(){var nextIndex,currentIndex=this.get("currentTrackIndex");if(this.get("shuffle")){nextIndex=Math.floor(Math.random()*this.tracks.length)}else{nextIndex=currentIndex+1>=this.tracks.length?0:currentIndex+1}this.setCurrentTrack(nextIndex)},pause:function(){clearInterval(this.playIntervalId);this.media.pause()},play:function(){var player=this;clearInterval(this.playIntervalId);this.playIntervalId=setInterval(function(){if(player.mediaCanPlay&&null===player.currentTimeIntervalId){"play"in player.media&&player.media.play();clearInterval(player.playIntervalId)}},50)},previousTrack:function(){var currentIndex=this.get("currentTrackIndex"),previousIndex=currentIndex-1<0?this.tracks.length-1:currentIndex-1;this.setCurrentTrack(previousIndex)},setCurrentTime:function(time){var player=this;clearInterval(this.currentTimeIntervalId);this.currentTimeIntervalId=setInterval(function(){if(4===player.media.readyState){player.media.setCurrentTime(time);clearInterval(player.currentTimeIntervalId);player.currentTimeIntervalId=null}},50)},setCurrentTrack:function(index){while(index>=this.tracks.length){index--}if(index!==this.get("currentTrackIndex")||null===this.currentTrack){this.set("currentTrackIndex",index);this.loadTrack(this.tracks.at(index))}return this},setVolume:function(volume){this.media.volume=volume},stop:function(){this.media.pause()},bindAudio:function(audio){audio.addEventListener("canplay",this.onMediaCanPlay);audio.addEventListener("loadedmetadata",this.onMediaCanPlay);audio.addEventListener("ended",this.onMediaEnded);audio.addEventListener("loadedmetadata",this.onMediaLoadedMetadata);audio.addEventListener("error",this.onMediaError);audio.addEventListener("pause",this.onMediaPause);audio.addEventListener("playing",this.onMediaPlaying);audio.addEventListener("loadedmetadata",this.onMediaTimeUpdate);audio.addEventListener("timeupdate",this.onMediaTimeUpdate);audio.addEventListener("volumechange",this.onMediaVolumeChange)},onMediaCanPlay:function(){this.mediaCanPlay=true},onMediaTimeUpdate:function(){this.set("currentTime",this.media.currentTime)},onMediaEnded:function(){if(this.get("repeat")){this.play()}else if(this.get("currentTrackIndex")<this.tracks.length||this.get("loop")||this.get("shuffle")){this.nextTrack();this.play()}},onMediaError:function(e){this.set("status","error");this.currentTrack&&this.currentTrack.set("status","error")},onMediaLoadedMetadata:function(){this.set("duration",this.media.duration)},onMediaPause:function(){this.set("status","paused");this.currentTrack.set("status","paused")},onMediaPlaying:function(){this.set("status","playing");this.currentTrack.set("status","playing")},onMediaVolumeChange:function(){this.set("volume",this.media.volume)},fetch:function(){var attributes,tracks;if(!this.options.persist){this.setCurrentTrack(this.get("currentTrackIndex"));return}attributes=JSON.parse(localStorage.getItem(this.options.id));if(null===attributes){this.setCurrentTrack(this.get("currentTrackIndex"));return}this.setCurrentTrack(attributes.currentTrackIndex);this.setCurrentTime(attributes.currentTime);this.initialCurrentTime=attributes.currentTime;if("playing"===attributes.status&&!mejs.MediaFeatures.isAndroid&&!mejs.MediaFeatures.isiOS){this.play()}},fetchTracks:function(){var cachedSignature=localStorage.getItem(this.options.id+"-signature");if("signature"in this.options&&cachedSignature!==this.options.signature){localStorage.removeItem(this.options.id);localStorage.removeItem(this.options.id+"-signature");localStorage.removeItem(this.options.id+"-tracks");return}this.tracks.fetch()},save:function(){if(!this.options.persist){return}localStorage.setItem(this.options.id,JSON.stringify(this.toJSON()));if("signature"in this.options){localStorage.setItem(this.options.id+"-signature",this.options.signature)}}});module.exports=Player},{"./tracks":3}],2:[function(require,module,exports){var Track=Backbone.Model.extend({defaults:{title:"",artist:"",album:"",artwork:"",duration:0,length:"",src:"",status:"",type:"",order:0,recordId:0,trackId:0},initialize:function(attributes,options){if("string"===typeof attributes){this.set("src",attributes)}if("undefined"===typeof attributes.type||""===attributes.type){if(-1!==this.get("src").indexOf("youtube")){this.set("type","audio/youtube")}else{this.set("type",mejs.HtmlMediaElementShim.getTypeFromFile(this.get("src")))}}}});module.exports=Track},{}],3:[function(require,module,exports){var Tracks,Track=require("./track");Tracks=Backbone.Collection.extend({model:Track,initialize:function(models,options){this.options=_.extend({id:"huesos-player-tracks"},options)},fetch:function(){var tracks;tracks=JSON.parse(localStorage.getItem(this.options.id));if(null!==tracks){this.reset(tracks)}},save:function(){localStorage.setItem(this.options.id,JSON.stringify(this.toJSON()))}});module.exports=Tracks},{"./track":2}],4:[function(require,module,exports){(function(global){"use strict";var $=typeof window!=="undefined"?window.jQuery:typeof global!=="undefined"?global.jQuery:null;window.huesos=window.huesos||{};_.extend(huesos,{player:{},players:{},model:{},view:{}});huesos.player.settings=_huesosPlayerSettings||{};huesos.l10n=_.extend({mute:"Mute",pause:"Pause",play:"Play",togglePlaylist:"Toggle Playlist",unmute:"Unmute"},huesos.player.settings.l10n);delete huesos.player.settings.l10n;huesos.model.Track=require("./models/track");huesos.model.Tracks=require("./models/tracks");huesos.model.Player=require("./models/player");huesos.view.Player=require("./views/player");huesos.view.Playlist=require("./views/playlist");huesos.view.RecordWidget=require("./views/record-widget");huesos.view.Track=require("./views/track");huesos.view.TogglePlaylistButton=require("./views/toggle-playlist-button");huesos.view.VolumePanel=require("./views/volume-panel");huesos.view.VolumeSlider=require("./views/volume-slider");$(document).ready(function($){var player,playerView,tracks,data=JSON.parse($("#huesos-player-settings").html());tracks=new huesos.model.Tracks(data.tracks);player=huesos.players.huesos=new huesos.model.Player({},{persist:true,signature:data.signature,tracks:tracks});player.fetch();player.listenTo(player.tracks,"remove",function(){if(this.tracks.length<1){this.tracks.add(data.tracks)}});playerView=new huesos.view.Player({player:player}).render();$(".js-play-record").off("click").each(function(){new huesos.view.RecordWidget({el:this,player:player,recordId:$(this).data("record-id"),trackId:$(this).data("track-id")})})})}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"./models/player":1,"./models/track":2,"./models/tracks":3,"./views/player":5,"./views/playlist":6,"./views/record-widget":7,"./views/toggle-playlist-button":8,"./views/track":9,"./views/volume-panel":10,"./views/volume-slider":11}],5:[function(require,module,exports){var Player,l10n=huesos.l10n,Playlist=require("./playlist"),TogglePlaylistButton=require("./toggle-playlist-button"),VolumePanel=require("./volume-panel");Player=Backbone.View.extend({className:"huesos-player fade-in",tagName:"div",template:wp.template("huesos-player"),events:{"click .next":"nextTrack","click .play-pause":"togglePlayback","click .previous":"previousTrack","click .progress-bar":"seek","click .volume-bar":"changeVolume"},initialize:function(options){this.player=options.player;this.listenTo(this.player,"change:status",this.toggleStatus);this.listenTo(this.player,"change:currentTime",this.updateCurrentTime);this.listenTo(this.player,"change:track",this.updateDetails);this.listenTo(this.player,"change:duration",this.updateDuration);this.listenTo(this.player.tracks,"add remove reset",this.updateTracksCount)},render:function(){this.$el.html(this.template(this.player.currentTrack.toJSON())).appendTo("#page");this.$artist=this.$el.find(".artist");this.$controls=this.$el.find(".controls");this.$currentTime=this.$el.find(".current-time");this.$duration=this.$el.find(".duration");this.$playBar=this.$el.find(".play-bar");this.$playPause=this.$el.find(".play-pause");this.$progressBar=this.$el.find(".progress-bar");this.$title=this.$el.find(".title");if(!mejs.MediaFeatures.isAndroid&&!mejs.MediaFeatures.isiOS){this.$controls.append(new VolumePanel({parent:this,player:this.player}).render().el)}this.$controls.append(new TogglePlaylistButton({parent:this}).render().el);this.$el.append(new Playlist({parent:this,player:this.player}).render().el);this.toggleStatus();this.updateCurrentTime();this.updateDetails(this.player.currentTrack);this.updateDuration();this.updateTracksCount();return this},changeVolume:function(e){var position=e.pageX-this.$volumeBar.offset().left,percent=position/this.$volumeBar.outerWidth();this.player.setVolume(Number(percent.toFixed(2)))},nextTrack:function(e){this.player.nextTrack();this.player.play()},previousTrack:function(e){this.player.previousTrack();this.player.play()},seek:function(e){var duration=this.player.get("duration"),position=e.pageX-this.$progressBar.offset().left,percent=position/this.$progressBar.outerWidth();percent=percent<.05?0:percent;this.player.setCurrentTime(percent*duration)},togglePlayback:function(){if("playing"===this.player.get("status")){this.player.pause()}else{this.player.play()}},toggleStatus:function(){var isPlaying="playing"===this.player.get("status");this.$el.toggleClass("is-playing",isPlaying);this.$playPause.text(isPlaying?l10n.pause:l10n.play).toggleClass("play",!isPlaying).toggleClass("pause",isPlaying)},updateCurrentTime:function(){var currentTime=this.player.get("currentTime"),currentTimeCode=mejs.Utility.secondsToTimeCode(currentTime,false);this.$currentTime.text(currentTimeCode);this.$playBar.width(this.player.getProgress()*100+"%")},updateDetails:function(){this.$artist.text(this.player.currentTrack.get("artist"));this.$title.text(this.player.currentTrack.get("title"))},updateDuration:function(){var durationTimeCode=mejs.Utility.secondsToTimeCode(this.player.get("duration"),false);this.$duration.text(durationTimeCode)},updateTracksCount:function(){this.$el.removeClass(function(index,classes){return(classes.match(/\s?tracks-count-\d+/g)||[]).join(" ")}).addClass("tracks-count-"+this.player.tracks.length)}});module.exports=Player},{"./playlist":6,"./toggle-playlist-button":8,"./volume-panel":10}],6:[function(require,module,exports){var Playlist,Track=require("./track");Playlist=Backbone.View.extend({className:"playlist",tagName:"div",initialize:function(options){this.parent=options.parent;this.player=options.player;this.$window=Backbone.$(window);this.$toolbar=Backbone.$("#wpadminbar");this.listenTo(this.player.tracks,"add",this.addTrack);_.bindAll(this,"updateMaxHeight");this.$window.on("load resize orientationchange scroll",_.throttle(this.updateMaxHeight,250))},render:function(){this.$el.empty().append('<ol class="tracks-list"></ol>');this.$tracksList=this.$el.find(".tracks-list");this.player.tracks.each(this.addTrack,this);return this},addTrack:function(track){this.$tracksList.append(new Track({model:track,player:this.player}).render().el)},updateMaxHeight:function(){var windowHeight,viewportWidth=window.innerWidth||this.$window.width();if(viewportWidth>=1024){windowHeight=window.innerHeight||this.$window.height();this.$el.css("maxHeight",windowHeight-this.$toolbar.height()-this.parent.$el.height()+"px")}else{this.$el.css("maxHeight","none")}}});module.exports=Playlist},{"./track":9}],7:[function(require,module,exports){var RecordWidget=Backbone.View.extend({events:{click:"click"},initialize:function(options){this.recordId=options.recordId||parseInt(this.$el.data("recordId"),10);this.trackId=options.trackId||parseInt(this.$el.data("trackId"),10);this.isTrack=this.trackId&&!_.isNaN(this.trackId);this.player=options.player;this.listenTo(this.player,"change:track change:status",this.toggleState)},render:function(){this.toggleState();return this},click:function(e){var model,$target=jQuery(e.target),$forbidden=this.$el.find("a, .js-disable-playpause");if($target.is($forbidden)||!!$forbidden.find($target).length){return}e.preventDefault();e.stopPropagation();if(this.$el.hasClass("is-playing")){this.player.pause();return}if(this.isTrack){model=this.player.tracks.findWhere({trackId:this.trackId})}else{model=this.player.tracks.findWhere({recordId:this.recordId})}if(model){this.player.setCurrentTrack(this.player.tracks.indexOf(model));this.player.play()}else{this.loadRecord()}},loadRecord:function(){var self=this,player=this.player;jQuery.ajax({url:_huesosSettings.ajaxUrl,type:"GET",data:{action:"huesos_get_record_data",record_id:this.recordId},dataType:"json"}).done(function(response){var model;if(!response.success){return}player.tracks.add(response.data.tracks);if(self.isTrack){model=player.tracks.findWhere({trackId:self.trackId})}else{model=player.tracks.get(response.data.tracks[0].id)}player.setCurrentTrack(player.tracks.indexOf(model));player.play()})},toggleState:function(){var isPlaying="playing"===this.player.get("status"),currentRecordId=this.player.currentTrack.get("recordId"),currentTrackId=this.player.currentTrack.get("trackId");if(this.isTrack){this.$el.toggleClass("is-playing",isPlaying&&this.trackId===currentTrackId)}else{this.$el.toggleClass("is-playing",isPlaying&&this.recordId===currentRecordId)}}});module.exports=RecordWidget},{}],8:[function(require,module,exports){var TogglePlaylistButton,l10n=huesos.l10n;TogglePlaylistButton=Backbone.View.extend({className:"toggle-playlist",tagName:"button",events:{click:"togglePlaylist"},initialize:function(options){this.parent=options.parent},render:function(){this.$el.text(l10n.togglePlaylist);return this},togglePlaylist:function(){var isOpen=this.parent.$el.hasClass("is-playlist-open");this.parent.$el.toggleClass("is-playlist-open",!isOpen);this.$el.toggleClass("is-open",!isOpen)}});module.exports=TogglePlaylistButton},{}],9:[function(require,module,exports){var Track=Backbone.View.extend({className:"track",tagName:"li",template:wp.template("huesos-player-track"),events:{click:"play","click .js-remove":"destroy"},initialize:function(options){this.player=options.player;this.listenTo(this.model,"change:status",this.updateStatus);this.listenTo(this.model,"destroy",this.remove);this.listenTo(this.player,"change:track",this.updateCurrent);this.listenTo(this.player,"change:track change:status",this.updateStatus)},render:function(){this.$el.html(this.template(this.model.toJSON()));this.updateCurrent();this.updateStatus();return this},play:function(e){var $target=jQuery(e.target),$forbidden=this.$el.find("a, .js-remove"),index=this.player.tracks.indexOf(this.model);if($target.is($forbidden)||!!$forbidden.find($target).length){return}this.player.setCurrentTrack(index).play()},destroy:function(e){e.preventDefault();this.model.trigger("destroy",this.model)},remove:function(){this.$el.remove()},updateCurrent:function(){this.$el.toggleClass("is-current",this.player.currentTrack.get("id")===this.model.get("id"))},updateStatus:function(){var isPlaying="playing"===this.player.get("status");this.$el.toggleClass("is-playing",isPlaying&&this.player.currentTrack===this.model);this.$el.toggleClass("is-error","error"===this.model.get("status"))}});module.exports=Track},{}],10:[function(require,module,exports){var VolumePanel,l10n=huesos.l10n,VolumeSlider=require("./volume-slider");VolumePanel=Backbone.View.extend({className:"volume-panel",tagName:"div",events:{"click .volume-toggle":"toggleMute"},initialize:function(options){this.parent=options.parent;this.player=options.player;this.listenTo(this.player,"change:volume",this.updateClasses)},render:function(){this.$el.append('<button class="volume-toggle">'+l10n.mute+"</button>");this.$toggleButton=this.$el.find(".volume-toggle");this.$el.append(new VolumeSlider({parent:this,player:this.player,playerView:this.parent.parent}).render().el);return this},toggleMute:function(){var volume=this.player.get("volume")<.05?.8:0;this.player.setVolume(volume)},updateClasses:function(){var isMuted=this.player.get("volume")<.05;this.parent.$el.toggleClass("is-muted",isMuted);this.$toggleButton.toggleClass("is-muted",isMuted).text(isMuted?l10n.unmute:l10n.mute)}});module.exports=VolumePanel},{"./volume-slider":11}],11:[function(require,module,exports){var VolumeSlider=Backbone.View.extend({className:"volume-slider",tagName:"div",events:{mousedown:"activateSlider",pointerdown:"activateSlider",touchstart:"activateSlider"},initialize:function(options){this.parent=options.parent;this.player=options.player;this.playerView=options.playerView;this.isHandleActive=false;this.listenTo(this.player,"change:volume",this.updateHandlePosition);_.bindAll(this,"adjustVolume","deactivateSlider");Backbone.$(window).on("mouseup pointerup touchend",this.deactivateSlider).on("mousemove pointermove touchmove",this.adjustVolume)},render:function(){this.$el.append('<span class="volume-slider-handle" role="slider"></span>');this.$handle=this.$el.find(".volume-slider-handle");this.updateHandlePosition();return this},activateSlider:function(e){this.isHandleActive=true;this.outerHeightOffset=(this.$el.outerHeight()-this.$el.height())/2;if($(e.target).hasClass("volume-slider")){this.player.setVolume(1-(e.pageY-(this.$el.offset().top+this.outerHeightOffset))/this.$el.height())}},adjustVolume:function(e){var lowerBoundary,sliderHeight,upperBoundary;if(!this.isHandleActive){return}sliderHeight=this.$el.height();upperBoundary=this.$el.offset().top+this.outerHeightOffset;lowerBoundary=upperBoundary+sliderHeight;if(e.pageY-upperBoundary<0||e.pageY-lowerBoundary>0){return}this.player.setVolume(1-(e.pageY-upperBoundary)/sliderHeight)},deactivateSlider:function(){this.isHandleActive=false},updateHandlePosition:function(){this.$handle.css("top",100-this.player.get("volume")*100+"%")}});module.exports=VolumeSlider},{}]},{},[4]);